# CHAPTER 10 클라이언트와의 대화 2 : 세션
## 01 세션 사용하기: session 기본 객체
웹 브라우저에 정보를 보관할 때 쿠키를 사용한다면 세션은 오직 서버에만 생성된다.
기본적으로 한 웹 브라우저마다 한 세션을 생성한다.
같은 JSP 페이지라도 웹 브라우저에 따라 서로 다른 세션을 사용한다.
따라서 쿠키가 클라이언트 측의 데이터 보관소라면 세션은 서버 측의 데이터 보관소이다.

### 1.1 세션 생성하기
JSP에서 세션을 생성하려면 page 디렉티브의 session 속성을 "true"로 지정하면 된다.
```java
<%@ page session = "true" %>
```
세션을 사용하는 서버 프로그램에 웹 브라우저가 처음 접속할 때 세션을 생성하고, 이후로는 이미 생성된 세션을 사용한다.

### 1.2 session 기본 객체
세션을 사용한다는 것은 session 기본 객체를 사용한다는 것을 말한다.
세션을 구분하기 위해 세션마다 고유 ID를 할당하는데 그 아이디를 세션 ID라고 한다. 웹 서버는 웹 브라우저에 세션 ID를 전송한다.
웹 브라우저는 웹 서버에 연결할 때마다 매번 세션 ID를 보내서 웹 서버가 어떤 세션을 사용할지 판단할 수 있게 한다.
웹 서버는 세션 ID를 이용해서 웹 브라우저를 위한 세션을 찾기 때문에, 웹 서버와 웹 브라우저는 세션 ID를 공유할 수 있는 JSESSIONID 쿠키를 사용한다.

### 1.3 기본 객체의 속성 사용
한 번 생성된 세션은 지정한 유효 시간 동안 유지된다. 
따라서 웹 어플리케이션을 실행하는 동안 지속적으로 사용해야 하는 데이터의 저장소로 세션이 적당하다.
request 기본 객체가 하나의 요청을 처리하는 데 사용되는 JSP 페이지 사이에서 공유된다면, session 기본 객체는 웹 브라우저의 여러 요청을 처리하는 JSP 페이지 사이에서 공유된다.
세션에 값을 저장할 때는 속성을 사용한다.
일단 session 기본 객체에 속성을 설정하면 세션이 종료되기 전까지는 다음과 같이 속성 값을 사용할 수 있다.
```java
<%
    String name = (String)session.getAttribute("NAME");
%>
회원명: <%= name %>
```

#### 쿠키 vs 세션
쿠키 대신 세션을 사용하는 가장 큰 이유는 세션이 쿠키보다 보안에서 앞선다는 점이다. 
세션을 사용하는 두 번째 이유는 웹 브라우저가 쿠키를 지원하지 않을 경우 또는 강제적으로 쿠키를 막는 경우 쿠키는 사용할 수 없게 되지만, 세션은 쿠키 설정 여부에 상관없이 사용할 수 있다는 점이다.
하지만 세션은 여러 서버에서 공유할 수 없다.
반면에 쿠키는 도메인을 이용해서 쿠키를 여러 도메인 주소에 공유할 수 있다.

### 1.4 세션 종료
세션을 유지할 필요가 없으면 session.invalidate() 메서드를 사용해서 세션을 종료한다. 세션을 종료하면 현재 사용중인 session 기본 객체를 삭제하고 session 기본 객체에 저장했던 속성 목록도 함께 삭제한다.
세션 종료 후 다음 요청에서 session을 사용하면 새로운 session 기본 객체를 생성한다.

### 1.5 세션 유효 기간
세션은 최근 접근 시간을 갖는다. session 기본 객체를 사용할 때마다 세션의 최근 접근 시간은 갱신된다.
세션은 마지막 접근 이후 일정 시간 이내에 다시 세션에 접근하지 않는 경우 자동으로 세션을 종료하는 기능을 갖고 있다.

#### 세션 유효 시간은 설정 방법
1. WEB-INF\web.xml 파일 이용하기<br>web.xml파일에 <session-config> 태그를 사용하여 세션 유효 시간을 지정하는 방법이다. 이 값의 범위는 분이다.
2. session 기본 객체가 제공하는 setMaxInactiveInterval() 메서드 이용하기<br>이 메서드는 초 단위로 유효 시간을 설정한다. <session-timeout>의 값을 0이나 음수로 설정하면 session.invalidate() 메서드를 실행하기 전까지 세션 객체가 계속 메모리에 남게 되어 메모리 부족 현상이 발생하게 된다. 제거되지 않는 세션 객체로 인해 메모리가 부족해지는 현상을 방지하려면, 반드시 세션 타임아웃 시간을 지정해주어야 한다.

### 1.6 request.getSession()을 이용한 세션 생성
HttpSession을 생성하는 또 다른 방법은 request 기본 객체의 getSession() 메서드를 사용하는 것이다. 
request.getSession()을 이용해서 세션을 구하므로, page 디렉티브의 session 속성값은 false로 지정한다.
session이 생성된 경우에만 session 객체를 구하고 싶다면, getSession() 메서드에 false를 인자로 전달하면 된다.
```java
<%@ page session="false" %>
<%
    HttpSession httpSession = request.getSession(false);
%>
```

## 02 세션을 사용한 로그인 상태 유지
1. 로그인에 성공하면 session 기본 객체의 특정 속성에 데이터를 기록한다.
2. 이후로 session 기본 객체의 특정 속성이 존재하면 로그인한 것으로 간주한다.
3. 로그아웃할 경우 session.invalidate() 메서드를 호출하여 세션을 종료한다.

### 2.1 인증된 사용자 정보 session 기본 객체에 저장하기
세션을 사용해서 로그인 상태를 유지하려면 session 기본 객체의 속성에 로그인 성공 정보를 저장하면 된다.

### 2.2 인증 여부 판단
session 기본 객체에 로그인 상태를 위한 속성의 존재 여부에 따라 로그인 상태를 판단할 수 있다. 
session 기본 객체의 속성을 사용해서 로그인 여부를 판단하면 된다.

### 2.3 로그아웃 처리
로그아웃을 처리할 때에는 session.invalidate() 메서드를 사용하여 세션을 종료하면 된다. 