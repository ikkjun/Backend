# CHAPTER 15 웹 어플리케이션의 일반적인 구성 및 방명록 구현
## 01 웹 어플리케이션의 전형적인 구성 요소
중복된 콛를 만들지 않는 여러 가지 방법 중 하나는 화면을 보여주기 위한 코드와 상관없이 사용자의 요청을 처리하는 코드를 별도 클래스로 분리하는 것이다.
또한 DB 처리와 같이 여러 기능에서 사용될 수 있는 코드를 별도 클래스로 분리하기도 한다.

### 1.1 웹 어플리케이션 주요 구성 요소
- Service 클래스: 사용자의 요청을 처리하는 기능을 제공한다.
- DAO 클래스: DB와 관련된 쿼리를 실행한다.
- JSP(뷰): Service 클래스가 실행한 결과를 화면에 출력하거나 Service가 기능을 수행하는 데 필요한 데이터를 전달한다.
- MVC 프레임워크: 사용자의 요청을 Service에 전달하고 Service의 실행결과를 JSP와 같은 뷰에 전달한다.

### 1.2 데이터 접근 객체(Data Access Object)의 구현
DAO 클래스는 데이터에 접근할 때 사용하는 객체를 위한 클래스를 의미한다.<br>
DAO 클래스가 제공하는 메서드:<br> 
- insert()
- select()
- update()
- delete()

#### 1.2.1 DAO에서 Connection에 접근하는 방식
DAO가 쿼리를 실행하려면 Statement나 PreparedStatement가 필요한데, 이 두 객체는 Connection 객체로부터 구할 수 있다.

Connection 객체를 구하는 방법
- DAO 클래스의 메서드에서 직접 Connection을 생성하기<br>DAO클래스를 사용할 때에는 DAO객체를 생성하고 메서드를 호출한다.<br>단점: 메서드를 실행할 때마다 매번 Connection을 생성한다. 이로 인해 두 개의 메서드를 하나의 트랜잭션으로 처리할 수 없다.
- DAO 객체를 생성할 때 생성자로 Connection을 전달받기<br>각 메서드는 하나의 Connection 객체를 사용하기 때문에 JDBC 트랜잭션을 이용할 수 있다.<br>단점: 매번 새로운 Connection을 생성한다.
- DAO 클래스의 메서드 파라미터로 Connection을 전달받기<br>한 개의 Connection객체를 사용하므로 JDBC 트랜잭션을 사용할 수 있으며 DAO 객체를 매번 생성하지 않아도 된다.<br>단점: DAO 객체의 메서드를 실행할 때마다 Connection 객체를 파라미터로 전달해야 하므로 메서드 호출 코드가 다소 길어진다.

#### 1.2.2 간단한 close() 및 rollback() 처리 코드를 위한 JdbcUtil
Connection, Statement 그리고 ResultSet과 같은 클래스는 사용이 끝나면 close() 메서드를 호출해서 자원을 반환해야 한다.
그래서 항상 close() 할 수 있도록 finally 블록에서 close() 메서드를 호출하도록 구현한다.

### 1.3 서비스 클래스의 구현
서비스 클래스는 주로 DAO를 통해서 데이터에 접근하고 기능을 수행하는 데 필요한 로직을 구현한다.

#### 1.3.1 서비스 클래스와 트랜잭션 처리
서비스 클래스가 제공하는 기능을 트랜잭션 범위에서 처리해야 한다면, 메서드에서 로직을 실행하기 전에 Connection.setAutoCommit(false)를 실행하고 모든 코드가 종료되면 Connection.commit()을 실행해서 트랜잭션을 커밋해야 한다.

#### 1.3.2 서비스 클래스의 익셉션 처리
서비스 클래스가 제공하는 메서드는 내부적으로 데이터베이스 처리 실패와 같은 익셉션이 발생하면 그 익셉션을 그대로 전파하지 않고 서비스에 알맞은 익셉션을 생성해서 발생시키는 것이 좋다.
서비스 클래스는 내부적으로 발생한 익셉션뿐만 아니라 논리적으로 잘못된 경우에도 익셉션을 발생시켜야 한다.

### 1.4 싱글톤(Singleton) 패턴을 이용한 구성 요소 구현
한 개의 서비스 객체를 여러 번 사용하는 것과 매번 새로운 서비스 객체를 사용하는 것이 기능상 차이가 없다면, 
매번 새로운 서비스 객체를 생성하지 않고 한 개의 객체를 재사용하도록 구현하려고 할 때 싱글톤(Singleton) 패턴을 사용한다.

### 1.5 Connectio을 제공하는 ConncetionProvider 만들기
JDBC URL과 같은 DB 연결 설정 정보를 더욱 쉽게 변경할 수 있으려면, DriverManager.getConnection()을 직접 호출해서 
Connection 객체를 구하기 보다는 Connection을 제공해주는 기능을 별도의 클래스로 분리해주어야 한다.

