# CHAPTER 03 JSP로 시작하는 웹 프로그래밍
## 01 JSP에서 HTML 문서를 생성하는 기본 코드 구조
일반적인 JSP코드 = JSP 페이지에 대한 정보를 입력하는 설정 부분 + HTML 문서를 생성하는 부분
- JSP 페이지에 대한 정보를 입력하는 설정 부분
  - JSP 페이지가 생성하는 문서의 타입(종류)
  - JSP 페이지에서 사용할 커스텀 태그
  - JSP 페이지에서 사용할 자바 클래스 지정<br>

캐릭터 셋(character set)은 문자정보 데이터베이스로서 문자 집합을 정의한 Unicode와 같ㄷ다.
Unicode를 부호화(encoding) 한 것이 인코딩(UTF-8, UTF-16, UTF-32)이다.
<%@ page ... %>를 page 디렉티브라고 하는데, JSP 페이지에 대한 정보를 설정할 때 page 디렉티브를 사용한다.

## 02 JSP 페이지의 구성 요소
- 디렉티브(Directive)
- 스크립트: 스크립트릿(Scriptlet), 표현식(Expression), 선언부(Declaration)
- 표현 언어(Expression Language)
- 기본 객체(Implicit Object)
- 정적인 데이터
- 표준 액션 태그(Action Tag)
- 커스텀 태그(Custom Tag)와 표준 태그 라이브러리(JSTL)

## 03 page 디렉티브
```java
<%@ page contentType="text/html; charset=urf-8"%>
<%@ page import="java.uril.Date"%>
```
### 3.1 contentType 속성과 캐릭터 셋
contentType은 JSP가 생성할 문서의 MIME 타입을 입력한다. MIME(Multipurpose Internet Mail Extensions)은 이메일의 내용을 설명하기 위해 정의되었다. 
하지만 메일뿐만 아니라 HTTP 등의 프로토콜에서도 응답 데이터의 내용을 설명하기 위해서 MIME를 사용하고 있다.

contentType 속성의 값 중에서 "; charset=캐릭터 셋" 부분은 생략할 경우 기본 캐릭터 셋인 ISO-8859-1을 사용하게 된다.
그러나 영어와 서유럽어의 문자만 포함하고 있는 ISO-8859-1로는 한글을 제대로 표현할 수 없기 때문에 EUC-KR이나 UTF-8과 같이 한국어를 포함하고 있는 캐릭터 셋을 사용해야 한다.

### 3.2 import 속성
import 속성의 사용방법
```java
<%@ page import = "java.util.Calendar"%>
<%@ page import = "java.util.Date"%>
```
또는 
```java
<%@ page import = "java.util.Calendar, java.util.Date"%>
```

### 3.3 trimDirectiveWhitespaces 속성을 이용한 공백 처리
서블릿 파일을 실행한 뒤 웹 브라우저에서 소스 보기를 하면 첫 줄에 빈줄이 생성된다.
이 첫줄의 공백은 page 디렉티브가 있던 위치에서 만들어진 것이다.
trimDirectiveWhitespaces 속성의 값을 true로 지정하면 디렉티브나 스크립트 코드 위치에서 발생하는 줄바꿈 공백 문자를 제거해준다.

### 3.4 JSP 페이지의 인코딩과 pageEncoding 속성
JSP 파일을 읽을 때는 page 디렉티브의 pageEncoding 속성과 contentType 속성을 사용해서 캐릭터 인코딩을 결정한다.

BOM(Byte Order Mark)은 UTF-8, UTF-16, UTF-32와 같은 유니코드 인코딩에서 바이트의 순서가 리틀 엔디언(Little Endian)인지 빅 엔디언(Big Endian)인지의 여부를 알려주는(mark) 16비트(2바이트) 값이다.

파일이 유니코드가 아니거나 파일이 BOM으로 시작하지 않을 경우, 먼저 pageEncoding 속성을 검색하고 그 다음에 contentType 속성의 charset의 값을 검색하게 된다.
따라서 pageEncoding 속성을 지정하지 않은 상태에서 contentType 속성의 charset의 값을 잘못 지정하면 잘못된 인코딩을 이용해서 파일을 읽어오게 되며, 이는 문자가 깨져서 출력되는 원인이 된다.
pageEncoding속성에 지정한 인코딩과 contentType 속성에 지정한 인코딩이 서로 다를 수도 있다.
JSP 파일은 UTF-8로 작성하고 응답 결과는 EUC-KR로 생성하고 싶다면, pageEncoding 속성은 "utf-8"로 지정하고 contentType 속성의 charset은 "euc-kr"로 지정하면 된다.

## 04 스크립트 요소
JSP의 스크립트 요소는 다음의 세 가지가 있다.
- 스크립트릿(Scriptlet)
- 표현식(Expression)
- 선언부(Declaration)

### 4.1 스크립트릿
스크립트릿(scriptlet)은 JSP 페이지에서 자바 코드를 실행할 때 사용하는 코드 블록이다. 
```java
<%
    자바코드1;
    자바코드2;
    자바코드3;
%>
```
스크립트릿의 코드 블록은 '<%'로 시작해서 '%>'로 끝나며, '<%'와 '%>' 사이에는 실행할 자바 코드가 위치한다.

### 4.2 표현식
표현식(Expression)은 어떤 값을 출력 결과에 포함시키고자 할 때 사용된다.
표현식은 '<%='로 시작해서 '%>'로 끝나며, 이 둘 사이에는 출력할 값이 위치한다.
```java
<%= 값 %>
```

### 4.3 선언부
JSP 페이지의 스크립트릿이나 표현식에서 사용할 수 있는 메서드를 작성할 때에는 선언부(declaration)를 사용한다.
```java
<%
    public 리턴타입 메서드이름(파라미터목록) {
        자바코드1;
        자바코드2;
        ...
        자바코드n;
        return 값;
    }
%>
```

## 05 request 기본 객체
웹 브라우저에 웹 사이트의 주소를 입력하면, 웹 브라우저는 해당 웹 서버에 연결한 후 요청 정보를 전송하는데, 
이 요청 정보를 제공하는 것이 바로 request 기본 객체(생성을 안 해도 쓸 수 있다)이다. 헤더 정보를 바꿀 수 없다.

request 기본 객체가 제공하는 기능
- 클라이언트(웹 브라우저)와 관련된 정보 읽기 기능
- 서버와 관련된 정보 읽기 기능
- 클라이언트가 전송한 요청 파라미터 읽기 기능
- 클라이언트가 전송한 요청 헤더 읽기 기능
- 클라이언트가 전송한 쿠키 읽기 기능
- 속성 처리 기능

### 5.1 클라이언트 정보 및 서버 정보 읽기
request 기본 객체는 웹 브라우저, 즉 클라이언트가 전송한 정보와 서버 정보를 구할 수 있는 메서드를 제공하고 있다.

### 5.2 요청 파라미터 처리
#### 5.2.1 HTML 폼과 요청 파라미터 
HTML <form>의 각 입력요소는 name 속성의 값이 입력 요소의 이름이 된다.
입력 요소의 이름은 웹 브라우저가 서버에 전송하는 요청 파라미터의 이름으로 사용된다.
웹 브라우저는 (파라미터이름=값) 형식으로 파라미터 목록을 웹 서버에 전송한다.
요청 URL을 처리할 웹 프로그램은 웹 브라우저가 전송한 요청 파라미터를 이용해서 알맞은 기능을 구현해야 한다.

#### 5.2.2 request 기본 객체의 요청 파라미터 관련 메서드
##### request 기본 객체의 파라미터 읽기 메서드
- getParameter(String name) 
- getParameterValues(String name)
- getParameterNames()
- getParameterMap()
입력한 데이터는 요청 파라미터로 전송되며, request 기본 객체의 메서드를 사용해서 요청 파라미터를 읽어올 수 있다.

같은 이름으로 전송되는 파라미터를 request.getParameter() 메서드는 모두 다 읽어오지 못하며, 오직 한 개의 값만 읽어올 수 있다. 
반면에 request.getParameterValues() 메서드는 같은 이름으로 전송된 파라미터의 값들을 배열로 리턴하기 때문에, 같은 이름을 가진 모든 파라미터의 값을 사용할 때에는 getParameter() 메서드가 아닌 getParameterValues() 메서드를 사용해야 한다.

체크박스를 아무것도 선택하지 않고 전송 버튼을 클릭하면 파라미터가 전송되지 않는다.

#### 5.2.3 GET 방식 전송과 POST 방식 전송
GET 방식과 POST 방식의 차이점은 전송 방식에 있다.<br> 
GET 방식은 요청 URL에 파라미터를 붙여서 전송한다.<br>
URL에 파라미터가 함께 전송되는 GET 방식과 달리 POST 방식은 데이터 영역을 이용해서 파라미터를 전송한다.<br>

GET 방식은 웹 브라우저, 웹 서버 또는 웹 컨테이너에 따라 전송할 수 있는 파라미터 값의 길이에 제한이 있을 수 있다. 
반면에 POST 방식은 데이터 영역을 이용해서 데이터를 전송하기 때문에 웹 브라우저나 웹 서버 등에 상관없이 전송할 수 있는 파라미터의 길이에 제한이 없다.

#### 5.2.4 요청 파라미터 인코딩
웹 브라우저는 웹 서버에 파라미터를 전송할 때 알맞은 캐릭터 셋을 이용해서 파라미터 값을 인코딩한다.
반대로 웹 서버는 알맞은 캐릭터 셋을 이용해서 웹 브라우저가 전송한 파라미터 데이터를 디코딩한다.

어떤 캐릭터 셋을 사용할지의 여부는 두 전송 방식 - GET 방식과 POST 방식 - 에 따라 달라진다.
##### POST 방식
입력 폼을 보여주는 응답화면이 사용하는 캐릭터 셋을 사용한다.<br>
request.getParameter() 메서드나 request.getParameterValues() 메서드는 요청 파라미터의 값을 읽어올 때 request.setCharacterEncoding()으로 지정한 캐릭터 셋을 이용해서 디코딩한다.

##### GET 방식
|GET 방식 이용 시 파라미터 전송 방법|인코딩 결정|
|---|---|
|<a\> 태그의 링크 태그에 쿼리 문자열 추가|웹 페이지 인코딩 사용|
|HTML 폼(FORM)의 method 속성값을 "GET"으로 지정해서 폼을 전송|웹 페이지 인코딩 사용|
|웹 브라우저의 주소에 직접 쿼리 문자열을 포함하는 URL 입력|웹 브라우저마다 다름|

GET 방식으로 전송된 파라미터에 대해서는 request.setCharacterEncoding() 메서드로 지정한 캐릭터 셋이 적용되지 않는다.

### 5.3 요청 헤더 정보의 처리
Accept: 브라우저(클라이언트) 에서 웹서버로 요청시 요청메시지에 담기는 헤더<br>
User-Agent: OS, 브라우저<br>
Content-Type: HTTP 메시지(요청과 응답 모두)에 담겨 보내는 데이터의 형식을 알려주는 헤더<br>
Referer: 내가 어떤 사이트에서 왔는지 알려주는 헤더<br>
Accept-Language<br>


## 06 response 기본 객체
request 기본 객체가 웹 브라우저가 전송한 요청 정보를 담고 있다면 response 기본 객체는 웹 브라우저에 보내는 응답 정보를 담는다.
response 기본 객체가 응답 정보와 관련해서 제공하는 기능은 두 가지가 있다.
- 헤더 정보 입력
- 리다이렉트 하기

### 6.1 웹 브라우저에 헤더 정보 전송하기 
response 기본 객체는 응답 정보에 헤더를 추가하는 기능을 제공한다.

### 6.2 웹 브라우저 캐시 제어를 위한 응답 헤더 입력
캐시(cache)란 같은 명령을 내릴 확률이 높으니까 메모리에 이전 응답을 가지고 있는 것이다.
JSP와 같은 웹 어플리케이션을 개발하다 보면 웹 브라우저가 서버가 생성한 결과를 출력하지 않고 캐시에 저장된 데이터를 출력하기 때문에
새로운 내용을 DB에 추가했는데도 웹 브라우저에 출력되는 내용이 바뀌지 않는 경우가 있다.
내용이 자주 바뀌지 않는 사이트는 웹 브라우저 캐시를 사용해서 보다 빠른 응답을 제공할 수 있다.

Cache-Control 응답 헤더의 값을 "no-cache"로 지정하면 응답 결과를 웹 브라우저가 캐시에 보관하지 않도록 설정할 수 있다.
그러나 "no-cache"로 설정하더라도 응답 내용을 캐시 저장소에 보관할 수 있다.
응답 결과가 캐시 저장소 자체에 보관되지 않도록 하려면, 이 헤더에 "no-store"를 추가한다.
캐시가 성능을 높이는 데 가장 중요하다.

### 6.3 리다이렉트를 이용해서 페이지 이동하기
리다이렉트는 웹 서버가 웹 브라우저에게 다른 페이지로 이동하라고 응답하는 기능이다.
response 기본 객체는 다음의 메서드를 사용해서 웹 브라우저가 리다이렉트하도록 지시할 수 있다.
```java
response.sendRedirect(String location)
```

response.sendRedirect() 메서드를 사용하는 경우 글자들을 URL에 포함시키려면 인코딩한 쿼리 문자열을 사용해야 한다.
java.net.URLEncoder클래스의 URLEncoder.encode() 메서드를 사용하면 파라미터 값으로 사용될 문자열을 지정한 캐릭터 셋으로 인코딩할 수 있다.
