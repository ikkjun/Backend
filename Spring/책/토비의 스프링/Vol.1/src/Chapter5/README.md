# 5장 서비스 추상화
## 5.1 사용자 레벨 관리 기능 추가
### 5.1.1 필드 추가
### 5.1.2 사용자 수정 기능 추가
### 5.1.3 UserService.upgradeLevels()
### 5.1.4 UserService.add()
### 5.1.5 코드 개선

사용자 레벨을 관리할 때는 정수를 직접 입력하는 것보다 enum을 활용하는 것이 안전하다.
비즈니스 로직을 분리한 서비스 클래스가 정의되어 있어야 변화에 유연하게 대응할 수 있다.

## 5.2 트랜잭션 서비스 추상화
### 5.2.1 모 아니면 도
### 5.2.2 트랜잭션 경계 설정
### 5.2.3 트랜잭션 동기화
### 5.2.4 트랜잭션 서비스 추상화

작업단위를 관리하고 싶다면 서비스 클래스에 트랜잭션 경계설정을 해야 한다.
트랜잭션은 하나의 DB와 연결된 로컬 트랜잭션과 여러 개의 DB에 연결된 글로벌 트랜잭션 방식이 있다. 
글로벌 트랜잭션을 만들기 위해 자바의 JTA를 활용해야 한다.

트랜잭션 경계설정 코드가 비즈니스 로직 코드에 영향을 주지 않으려면 스프링이 제공하는 트랜잭션 서비스 추상화를 이용하면 된다.
트랜잭션 서비스 추상화 기술인 PlatformTransactionManager 인터페이스로 구현한 클래스만 변경하면 하이버네이트, JPA, JDBC 등을 모두 사용할 수 있다.

## 5.3 서비스 추상화와 단일 책임 원칙

스프링의 DI를 통해 관심사를 분리한 코드는 수정할 부분이 명확해지는 단일책임원칙의 장점을 누릴 수 있다.

## 5.4 메일 서비스 추상화
### 5.4.1 JavaMail을 이용한 메일 발송 기능
### 5.4.2 JavaMail이 포함된 코드의 테스트
### 5.4.3 테스트를 위한 서비스 추상화
### 5.4.4 테스트 대역

확장이 불가능한 JavaMail에 대해 스프링은 메일 서비스 추상화 기능을 제공하고 있다.
메일이 제대로 전송됐는지 테스트할 때는 테스트 대역(table double)을 이용하면 된다.
테스트 대상 오브젝트의 간접적인 출력 결과를 확인하고 싶을 땐 스텁 오브젝트를 사용하면 된다.
그러나 테스트 대상 오브젝트가 의존 오브젝트에게 넘기는 값과 테스트 대상 오브젝트와 의존 오브젝트 사이에 일어나는 커뮤니케이션 자체를 검증하고 싶다면 목 오브젝트를 사용해야 한다.

## 5.5 정리