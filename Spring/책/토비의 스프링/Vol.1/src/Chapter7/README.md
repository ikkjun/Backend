# 7장 스프링 핵심 기술의 응용
## 7.1   SQL과 DAO의 분리
### 7.1.1 XML 설정을 이용한 분리
### 7.1.2 SQL 제공 서비스

SQL이 변경될 수 잇으므로 DAO에서 SQL을 분리해야 한다.
이 때 가장 간단하게 XML 설정을 이용해서 분리할 수 있다.
그러나 스프링 설정 파일 안에 SQL을 분리하는 것은 많은 문제점을 가지고 있으므로 독립적인 SQL 서비스 인터페이스를 설계해야 한다.

## 7.2   인터페이스의 분리와 자기참조 빈
### 7.2.1 XML 파일 매핑
### 7.2.2 XML 파일을 이용하는 SQL 서비스
### 7.2.3 빈의 초기화 작업
### 7.2.4 변화를 위한 준비: 인터페이스 분리
### 7.2.5 자기참조 빈으로 시작하기
### 7.2.6 디폴트 의존관계

JAXB(Java Architecture for XML Binding)로 XML 파일을 읽어서 DAO에게 전달하는 언마샬링 과정을 통해 SQL 서비스 구현 클래스를 생성해야 한다.
생성자내에 예외를 선언하거나 파일의 위치와 이름이 고정되어 있다는 문제점을 해결하기 위해 메서드에 @PostConstruct 애너테이션을 사용하여 빈을 초기화 해야 한다.
이 때 메서드가 수행하는 작업을 분리하기 위해 SQL 정보를 외부 리소스로부터 읽어오는 인터페이스와 읽어온 SQL 정보를 보관하고 있다가 필요할 때 제공하는 인터페이스를 독립적으로 정의해야 한다.
분리된 인터페이스들을 하나의 클래스에서 구현할 수 있게 DI를 해준다.
그러나 유연성을 보장하기 위해 디폴트 의존관계를 갖는 빈을 만들어야 할 때도 있다.
그래서 JaxXmlSqlReader에 디폴트 파일 이름을 설정해야 한다.

* 언마샬링: XML 문서를 읽어서 자바의 오브젝트로 변환하는 것
* 마샬링: 바인딩 오브젝트를 XML 문서로 변환하는 것
* 디폴트 의존관계: 외부에서 DI 받지 않는 경우 기본적으로 자동 적용되는 의존관계

## 7.3   서비스 추상화 적용
### 7.3.1 OXM 서비스 추상화
### 7.3.2 OXM 서비스 추상화 적용
### 7.3.3 리소스 추상화

다양한 OXM 기술이 적용될 수 있도록 OXM 서비스를 추상화해야 한다.
그리고 다양한 리소스를 어플리케이션이 읽을 수 있도록 리소스 추상화도 고려해야 한다.

* OXM(Object-XML Mapping): XML과 자바오브젝트를 매핑해서 상호 변환해주는 기술 
* OXM 종류
  1. Castor XML
  2. JiBX
  3. XmlBeans
  4. Xstream

## 7.4   인터페이스 상속을 통한 안전한 기능 확장
### 7.4.1 DI와 기능의 확장
### 7.4.2 인터페이스 상속

인터페이스 분리 원칙에 따라 DI를 의식하면서 설계해야 실시간으로 기능을 추가하거나 확장하는 유연성을 누릴 수 있다.

* 인터페이스 분리 원칙: 목적과 관심이 각기 다른 클라이언트가 있다면 인터페이스를 통해 이를 적절히 분리하는 것

## 7.5   DI를 이용해 다양한 구현 방법 적용하기
### 7.5.1 ConcurrentHashMap을 이용한 수정 기능
### 7.5.2 내장형 데이터베이스를 이용한 SQL 레지스트리 만들기
### 7.5.3 트랜잭션 적용

실시간으로 SQL을 변경하기 위해 동시성 문제를 고려해야 하는데, 이 때 가능한 방법으로는 ConcurrentHashMap을 이용하거나 내장형 DB를 이용하면 된다.
하지만 여러 개의 SQL을 수정하는 경우 트랜잭션이 적용되어야 하므로 트랜잭션을 적용하기 어려운 컬렉션보다 내장형 DB를 사용하는 방법이 더 쉽다.

* 내장형 DB: 애플리케이션에 내장돼서 애플리케이션과 함께 시작되고 종료되는 DB

## 7.6   스프링 3.1의 DI
### 7.6.1 자바 코드를 이용한 빈 설정
### 7.6.2 빈 스캐닝과 자동와이어링
### 7.6.3 컨텍스트 분리와 @Import
### 7.6.4 프로파일
### 7.6.5 프로퍼티 소스
### 7.6.6 빈 설정의 재사용과 @Enable*

스프링은 자바의 버전이 올라가면서 애너테이션으로 메타 정보를 작성하거나 정책과 관례를 이용한 프로그래밍 방식으로 전환하고 있다.
- DI 스타일로 변경하는 리펙토링 단계
  1. XML 파일에서 자바코드를 이용한 빈 설정
  2. 빈 스캐닝(자동 등록)과 자동 와이어링 기능 적용
  3. 성격이 다른 컨텍스트 분리하기
  4. 실행환경에 따라 빈 설정정보가 달라지도록 프로파일 적용하기
  5. 외부 서비스 연결에 필요한 정보를 프로퍼티 소스(파일)에 저장하기
  6. 빈 설정을 재사용할 수 있도록 전용 애노테이션 정의하기

## 7.7   정리